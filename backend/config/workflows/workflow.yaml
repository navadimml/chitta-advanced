# Lifecycle Events - Wu Wei Configuration (×¤×©×•×˜ - × ×˜×•×œ ×—×œ×§×™× ×¢×•×“×¤×™×)
# ğŸŒŸ Wu Wei: No phases, no gates. Just prerequisites and moments.
#
# This file is the SINGLE SOURCE OF TRUTH for:
# - Moments (when things happen based on prerequisites)
# - Cards (UI that reflects state - both event-triggered and persistent)
# - Card types (styling definitions)
#
# ğŸŒŸ v3.2: Merged context_cards.yaml into this file

version: "3.2"
workflow_name: "continuous_conversation_with_progressive_unlocking"

# ============================================
# CARD CONFIGURATION
# ============================================
# Card types define styling for different card purposes

card_types:
  progress:
    icon: "progress-bar"
    color: "blue"
    style: "informational"

  action_needed:
    icon: "alert-circle"
    color: "orange"
    style: "call-to-action"

  success:
    icon: "check-circle"
    color: "green"
    style: "celebration"

  guidance:
    icon: "lightbulb"
    color: "purple"
    style: "helpful"

  ongoing_support:
    icon: "heart"
    color: "pink"
    style: "supportive"

  loading:
    icon: "loader"
    color: "gray"
    style: "processing"

  suggestion:
    icon: "lightbulb"
    color: "yellow"
    style: "suggestion"

# Card display rules
display_rules:
  max_cards_visible: 4
  priority_ordering: true
  auto_dismiss: true
  animation: fade_in_out

# ============================================
# ALWAYS AVAILABLE
# ============================================
# Capabilities that require no prerequisites - available from first message
always_available:
  - conversation      # Talk to Chitta anytime about anything
  - journaling        # Record observations and milestones
  - consultation      # Get answers and guidance

# ============================================
# MOMENTS
# ============================================
# Moments that unlock progressively as prerequisites are met
# Each moment can include:
#   when: Prerequisites (flat dict with AND logic, OR: {} for alternatives)
#   artifact: Artifact ID to generate (optional)
#   message: Message to send when moment happens (optional)
#   ui: UI guidance to prevent hallucinations (optional)
#     type: UI element type (card, button, modal, banner, etc.)
#     default: Guidance text for default/desktop
#     mobile: Mobile-specific guidance (only if different)
#   card: UI card definition (optional) ğŸŒŸ NEW in v3.0
#     card_type: Card style (success, guidance, action_needed, progress, etc.)
#     priority: Display priority (higher = shown first)
#     title: Card title
#     body: Card content (supports markdown and placeholders like {child_name})
#     footer: Optional footer text
#     actions: List of action IDs available from this card
#     dismissible: Whether user can dismiss the card
#     auto_dismiss_after_action: Action that auto-dismisses the card
#     celebration_animation: Show celebration animation
# NOTE: Removed 'unlocks' field - capabilities are auto-discovered from artifacts!
#
moments:
  # Welcome
  first_message:
    when:
      message_count: 0
    message: |
      ×©×œ×•×! ×× ×™ ×›××Ÿ ×›×“×™ ×œ×”×›×™×¨ ××ª ×”×™×œ×“/×” ×©×œ×š ×•×œ×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ××ª ×”×”×ª×¤×ª×—×•×ª.
      ×¡×¤×¨×™ ×œ×™ - ××” ××¢× ×™×™×Ÿ ××•×ª×š? ××” ×©××— ××•×ª×š? ××” ××“××™×’?

    # ğŸŒŸ Card displays when moment triggers
    card:
      card_id: "welcome_card"
      card_type: guidance
      priority: 100

      # ğŸŒŸ Phase 1: Lifecycle configuration (Living Dashboard)
      lifecycle:
        trigger: transition
        dismiss_when:
          message_count: ">= 2"  # Dismiss after a couple messages
        prevent_re_trigger: true

      content:
        title: "×©×œ×•×, × ×¢×™× ×œ×”×›×™×¨! ğŸ’™"
        body: |
          ×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ×˜×•×‘ ×™×•×ª×¨ ××ª ×”×”×ª×¤×ª×—×•×ª ×©×œ ×”×™×œ×“/×” ×©×œ×š.

          **××™×š ×–×” ×¢×•×‘×“?**
          1. × ×“×‘×¨ ×¢×œ ×”×™×œ×“/×” - ×”×©×™×—×” ×—×•×¤×©×™×ª ×•× ×¢×™××”
          2. ××ª ×ª×¢×œ×™ 3 ×¡×¨×˜×•× ×™× ×§×¦×¨×™×
          3. ×× ×ª×— ×•××›×™×Ÿ ×¢×‘×•×¨×š ×“×•×— ××§×™×£

          **×”×›×œ ×¤×¨×˜×™ ×•×××•×‘×˜×—.** ××¤×©×¨ ×œ×”×ª×—×™×œ ××ª×™ ×©× ×•×— ×œ×š.
        footer: "×‘×•××™ × ×ª×—×™×œ - ×¡×¤×¨×™ ×œ×™ ×§×¦×ª ×¢×œ ×”×™×œ×“/×” ×©×œ×š ğŸ˜Š"

      actions:
        - continue_interview
        - view_privacy_policy
      dismissible: true

  # Knowledge richness milestone
  knowledge_rich:
    when:
      knowledge_is_rich: true
      baseline_video_guidelines.exists: false
      user_actions.declined_video_recording: false
    message: |
      ×ª×•×“×” ×©×¡×™×¤×¨×ª ×œ×™ ×›×œ ×›×š ×”×¨×‘×” ×¢×œ {child_name}! ğŸ’™

      ×× ×™ ××¨×’×™×©×” ×©×™×© ×œ×™ ×”×‘× ×” ×˜×•×‘×” ×¢×›×©×™×•. ×× ×ª×¨×¦×™, ××•×›×œ ×œ×”×›×™×Ÿ ×œ×š ×”× ×—×™×•×ª ××•×ª×××•×ª ×œ×¦×™×œ×•× ×¡×¨×˜×•× ×™× - ×–×” ×™×¢×–×•×¨ ×œ×™ ×œ×¨××•×ª ××ª {child_name} ×‘×¤×¢×•×œ×”.
    context: |
      <system_context type="knowledge_richness_reached">
      You (Chitta) have just reached knowledge richness threshold.

      What this means:
      - You've gathered enough information about the child from conversation
      - You now understand the parent's concerns, child's strengths, and developmental context
      - Video filming guidelines capability is about to unlock

      What you can now offer:
      âœ… Suggest creating personalized video filming guidelines
      âœ… Explain how videos will help you provide better insights
      âœ… Answer the parent if they ask "what's next?"

      How to suggest naturally:
      - "×× ×ª×¨×¦×™, ××•×›×œ ×œ×”×›×™×Ÿ ×œ×š ×”× ×—×™×•×ª ××•×ª×××•×ª ×œ×¦×™×œ×•×"
      - "×”×¦×¢×“ ×”×‘× ×”×•× ×¦×™×œ×•× ×¡×¨×˜×•× ×™× ×§×¦×¨×™× - ×–×” ×™×¢×–×•×¨ ×œ×™ ×œ×”×‘×™×Ÿ ×˜×•×‘ ×™×•×ª×¨"
      - Wait for parent's consent before generating guidelines

      What NOT to assume:
      âŒ Don't assume parent wants to do videos (they can decline)
      âŒ Don't generate guidelines without asking first
      âŒ Don't promise the report is ready (it's not - needs videos or explicit decline)

      This is a milestone moment - acknowledge the rich conversation naturally.
      </system_context>

  # ğŸŒŸ Wu Wei: Generate interview summary when knowledge is rich
  generate_interview_summary:
    when:
      knowledge_is_rich: true
      artifacts.baseline_interview_summary.exists: false
    artifact: "baseline_interview_summary"
    message: ""  # Silent generation - no user-facing message needed
    ui:
      type: "silent"  # Background process
    context: |
      <system_context type="interview_summary_generation">
      Generating structured interview summary from conversation.
      This summary will be used by video guidelines and reports.
      </system_context>

  # Baseline assessment flow - Parent choice model
  offer_filming:
    when:
      knowledge_is_rich: true
      filming_preference: null  # Not asked yet
    message: ""  # Chitta asks naturally in conversation (via system prompt)
    ui:
      type: "conversation"  # No card - just conversation
    context: |
      <system_context type="filming_decision_moment">
      IMPORTANT: You have gathered rich information about {child_name}.

      It's time to gently offer the parent a choice about filming their child.

      **Your approach should be:**
      1. Acknowledge how much they've shared - thank them warmly
      2. Explain that seeing {child_name} in video would add valuable context
      3. Describe benefits: "×¨×•××™× ×“×¤×•×¡×™×, ××™× ×˜×¨××§×¦×™×•×ª, ×ª×’×•×‘×•×ª ×‘×–××Ÿ ×××ª"
      4. Make it completely optional: "××™×Ÿ ×©×•× ×œ×—×¥ - × ×•×›×œ ×’× ×œ×”×›×™×Ÿ ×“×•×— ×¢×œ ×¡××š ×”×©×™×—×” ×©×œ× ×•"
      5. Ask clearly: "××” × ×•×— ×œ×š? ×œ×¦×œ× ×›××” ×¡×¨×˜×•× ×™× ×§×¦×¨×™×, ××• ×œ×”××©×™×š ×¨×§ ×‘×©×™×—×”?"

      **CRITICAL:**
      - Be warm and genuine, not pushy
      - Respect whatever they choose immediately
      - Don't make them feel guilty for declining
      - Frame both options as equally valid

      **After parent responds:**
      - Use extract_interview_data to set filming_preference:
        - "wants_videos" if they agree to film
        - "report_only" if they prefer report without videos
      - The system will automatically proceed based on their choice
      </system_context>

  generate_guidelines:
    when:
      filming_preference: "wants_videos"
      artifacts.baseline_interview_summary.exists: true  # ğŸŒŸ Wu Wei: Requires interview summary
      artifacts.baseline_video_guidelines.exists: false
    artifact: "baseline_video_guidelines"
    message: |
      ××¢×•×œ×”! ×× ×™ ××ª×—×™×œ×” ×œ×”×›×™×Ÿ ×”× ×—×™×•×ª ×¦×™×œ×•× ××•×ª×××•×ª ×œ{child_name} - ×–×” ×™×™×§×— ×¨×§ ×¨×’×¢ ğŸ’™

      ×”×”× ×—×™×•×ª ×™×•×¤×™×¢×• ×‘×›×¨×˜×™×¡ ×œ××˜×” ×‘×¨×’×¢ ×©×”×Ÿ ××•×›× ×•×ª.
    ui:
      type: "card"
      default: "×”×”× ×—×™×•×ª ×™×•×¤×™×¢×• ×‘×›×¨×˜×™×¡ '×”× ×—×™×•×ª ×¦×™×œ×•×' ×‘×¢×•×“ ×¨×’×¢×™× ×¡×¤×•×¨×™×"
    context: |
      <system_context type="video_guidelines_being_generated">
      â›”â›”â›” CRITICAL INSTRUCTION - READ CAREFULLY â›”â›”â›”

      You (Chitta) are triggering video guidelines generation. The artifact generator will create the guidelines.

      **YOU MUST USE THE MESSAGE PROVIDED ABOVE - DO NOT ADD ANYTHING!**

      âŒ DO NOT try to write the guidelines yourself
      âŒ DO NOT list filming scenarios like "1. ××©×—×§ ×—×‘×¨×ª×™... 2. ×©×¤×”..."
      âŒ DO NOT write "×”× ×—×™×•×ª ×¦×™×œ×•×:" followed by detailed instructions
      âŒ DO NOT make up ANY guidelines content
      âŒ DO NOT add "helpful" details about what to film

      **WHY:**
      - You DON'T have access to the artifact generator
      - The artifact generator creates guidelines, NOT you
      - Anything you write will be HALLUCINATED and WRONG
      - The real guidelines will appear in a CARD automatically

      âœ… ONLY say: "××¢×•×œ×”! ×× ×™ ××ª×—×™×œ×” ×œ×”×›×™×Ÿ ×”× ×—×™×•×ª ×¦×™×œ×•× ××•×ª×××•×ª ×œ{child_name} - ×–×” ×™×™×§×— ×¨×§ ×¨×’×¢ ğŸ’™"
      âœ… Or similar brief acknowledgment WITHOUT any guidelines content
      âœ… Keep response under 2 sentences
      âœ… Trust that the CARD will show the real guidelines

      **The parent will:**
      1. See your brief message
      2. See the guidelines CARD appear below (with real content from artifact generator)
      3. Click the card to view detailed guidelines
      4. Film and upload videos

      **Remember:**
      - SYSTEM analyzes videos, not you
      - You receive structured analysis data, you don't watch videos
      </system_context>

  offer_report_only:
    when:
      filming_preference: "report_only"
      artifacts.baseline_parent_report.exists: false
    message: ""  # Chitta responds naturally in conversation
    ui:
      type: "conversation"
    context: |
      <system_context type="report_without_videos_offered">
      The parent has chosen NOT to film videos - respect their choice completely.

      **What to say:**
      1. Acknowledge their choice warmly: "×× ×™ ××‘×™× ×” ×œ×’××¨×™"
      2. Reassure them: "×™×© ×œ×™ ×”×¨×‘×” ××™×“×¢ ××”×©×™×—×” ×©×œ× ×•"
      3. Offer report: "×× ×™ ×™×›×•×œ×” ×œ×”×›×™×Ÿ ×œ×š ×“×•×— ××¡×›× ×¢× ×ª×•×‘× ×•×ª ×•×”××œ×¦×•×ª ×¢×œ ×¡××š ×›×œ ××” ×©×¡×™×¤×¨×ª"
      4. Ask: "×¨×•×¦×” ×©××›×™×Ÿ ××ª ×”×“×•×—?"

      **After parent responds:**
      - If they want the report, a card will appear with a button to generate it
      - Continue the conversation naturally - they might share more information
      - Don't push for videos again unless they explicitly ask

      The conversation continues regardless of their choice.
      </system_context>

  videos_ready:
    when:
      uploaded_video_count: ">= 1"
    # NOTE: Videos are uploaded by parent, not generated as artifact
    message: |
      ××¢×•×œ×”! {uploaded_video_count} ×¡×¨×˜×•× ×™× ×”×•×¢×œ×•.
      ×× ×™ ××•×›× ×” ×œ× ×ª×— ××•×ª× - ×–×” ×™×™×§×— ×›-10-15 ×“×§×•×ª. ×‘×™× ×ª×™×™×, ×ª××™×“ ××¤×©×¨ ×œ×©××•×œ ×©××œ×•×ª ××• ×œ×”×•×¡×™×£ ×œ×™×•××Ÿ. ğŸ’™
    ui:
      type: "card"
      default: "×œ×—×¦×™ ×¢×œ ×”×›×¨×˜×™×¡ '× ×™×ª×•×— ×¡×¨×˜×•× ×™×' ×‘'×¤×¢×™×œ ×¢×›×©×™×•' ×œ××˜×” ×›×“×™ ×œ×”×ª×—×™×œ ××ª ×”× ×™×ª×•×—"
    context: |
      <system_context type="videos_uploaded">
      The parent has successfully uploaded {uploaded_video_count} videos.

      CRITICAL - Analysis process:
      1. Videos are stored in the SYSTEM (not sent to you directly)
      2. Parent will trigger analysis by clicking "× ×™×ª×•×— ×¡×¨×˜×•× ×™×" card in UI
      3. The SYSTEM will process videos and extract structured developmental data
      4. You will receive this structured data (observations, patterns, developmental markers)
      5. You CANNOT view the actual video files - only the analysis results

      What you should tell the parent:
      âœ… "×”×¡×¨×˜×•× ×™× ×”×•×¢×œ×• ×‘×”×¦×œ×—×”!"
      âœ… "×”× ×™×ª×•×— ×™×™×§×— ×›-10-15 ×“×§×•×ª"
      âœ… "×‘×™× ×ª×™×™× ××¤×©×¨ ×œ×”××©×™×š ×œ×©×•×—×— ××• ×œ×©××•×œ ×©××œ×•×ª"
      âœ… Direct them to click the analysis card in the UI

      What you should NEVER say:
      âŒ "×× ×™ ×¦×•×¤×” ×‘×¡×¨×˜×•× ×™×" / "I'm watching the videos"
      âŒ "×©×œ×—×™ ×œ×™ ××ª ×”×¡×¨×˜×•× ×™×" / "Send me the videos"
      âŒ Any claim about viewing video content directly

      Timeline expectations:
      - Analysis takes 10-15 minutes (system processing)
      - Parent stays engaged through conversation during wait
      - After analysis: You'll have rich observational data to discuss
      </system_context>

  analysis_done:
    when:
      baseline_videos.exists: true
      videos_analyzed: true
    artifact: "baseline_video_analysis"
    message: |
      ×”× ×™×ª×•×— ×”×•×©×œ×! ğŸ‰
      ××¦××ª×™ ×“×¤×•×¡×™× ××¢× ×™×™× ×™×. ×‘×•××™ × ×¡×›× ××ª ×›×œ ××” ×©×œ××“×ª×™ ×¢×œ {child_name} ×‘×“×•×— ××¡×•×“×¨.
    ui:
      type: "card"
      default: "×œ×—×¦×™ ×¢×œ ×”×›×¨×˜×™×¡ '×™×¦×™×¨×ª ×“×•×—' ×‘'×¤×¢×™×œ ×¢×›×©×™×•' ×œ××˜×” ×›×“×™ ×œ×™×¦×•×¨ ××ª ×”×“×•×— ×”××¡×•×“×¨"

    # ğŸŒŸ Card displays when moment triggers
    card:
      card_id: "analysis_done_card"
      card_type: success
      priority: 100

      # ğŸŒŸ Phase 1: Lifecycle configuration (Living Dashboard)
      lifecycle:
        trigger: transition
        dismiss_when:
          artifacts.baseline_professional_report.exists: true
        dismiss_on_action: generate_reports
        prevent_re_trigger: true

      content:
        title: "×”× ×™×ª×•×— ×”×•×©×œ×! ğŸ‰"
        body: |
          ××¦××ª×™ ×“×¤×•×¡×™× ××¢× ×™×™× ×™× ×‘×¡×¨×˜×•× ×™× ×©×œ {child_name}.

          ×‘×•××™ × ×¡×›× ×”×›×œ ×‘×“×•×— ××¡×•×“×¨.

      actions:
        - generate_reports
      dismissible: true
    context: |
      <system_context type="video_analysis_complete">
      Video analysis is complete! You now have structured developmental data.

      CRITICAL - What you have access to:
      - The artifact "baseline_video_analysis" contains structured observations
      - Developmental patterns extracted by the system from videos
      - Observations organized by domains (motor, language, social, cognitive, etc.)
      - Specific examples and timestamps of behaviors
      - You have DATA ABOUT the videos, not the video files themselves

      How to discuss findings:
      âœ… Reference specific observations from the analysis data
      âœ… "×¨××™×ª×™ ×‘× ×™×ª×•×— ×©..." (referring to analysis results, not direct viewing)
      âœ… Connect findings to parent's original concerns
      âœ… Discuss patterns and developmental indicators
      âœ… Be specific: "×‘×¡×¨×˜×•×Ÿ ×©×œ ×”××©×—×§ ×”×—×•×¤×©×™, {child_name}..." (from analysis data)

      What you can now suggest:
      âœ… "×‘×•××™ × ×¡×›× ×”×›×œ ×‘×“×•×— ××¡×•×“×¨"
      âœ… Offer to answer questions about specific observations
      âœ… Explain what the patterns mean developmentally

      What NOT to say:
      âŒ "×¦×¤×™×ª×™ ×‘×¡×¨×˜×•× ×™×" / "I watched the videos" (you analyzed RESULTS, didn't watch)
      âŒ Don't invent observations not in the analysis data
      âŒ Don't claim you can see new videos or view additional content

      Next step:
      - Suggest creating comprehensive report (generate_reports capability now unlocked)
      - Parent can click "×™×¦×™×¨×ª ×“×•×—" card to trigger report generation
      - Report will combine conversation insights + video analysis
      </system_context>

  # Parent declines video recording
  video_declined:
    when:
      knowledge_is_rich: true
      user_actions.declined_video_recording: true
      baseline_parent_report.exists: false
    message: |
      ××•×‘×Ÿ ×œ×—×œ×•×˜×™×Ÿ! ğŸ’™

      ×× ×™ ×™×›×•×œ×” ×œ×”×›×™×Ÿ ×œ×š ×“×•×— ××¡×•×“×¨ ×¢×œ ×¡××š ×”×©×™×—×” ×©×œ× ×• - ×–×” ×™×›×œ×•×œ ××ª ×›×œ ××” ×©×œ××“×ª×™ ×¢×œ {child_name}.
      ×¨×•×¦×” ×©××›×™×Ÿ ××ª ×”×“×•×—?
    context: |
      <system_context type="video_declined_alternative_path">
      The parent has declined video recording. This is completely valid.

      Alternative path:
      - You can still create a comprehensive report based on conversation alone
      - The report will be based on: parent's descriptions, concerns, examples, observations shared
      - This is a legitimate assessment path (conversation-based developmental consultation)

      What you should communicate:
      âœ… "××•×‘×Ÿ ×œ×—×œ×•×˜×™×Ÿ - ××¤×©×¨ ×’× ×‘×œ×™ ×¡×¨×˜×•× ×™×"
      âœ… "×”×“×•×— ×™×ª×‘×¡×¡ ×¢×œ ×›×œ ××” ×©×©×™×ª×¤×ª ××™×ª×™ ×‘×©×™×—×”"
      âœ… Offer to create conversation-based report
      âœ… Reassure this is a valid and helpful approach

      What's still available:
      âœ… Generate comprehensive parent report (conversation-based)
      âœ… Ongoing consultation and support
      âœ… Journal observations
      âœ… Answer developmental questions

      What's NOT available (without videos):
      âŒ Video analysis (obviously)
      âŒ Direct observational data
      âŒ Visual developmental markers

      Tone:
      - Completely accepting and non-judgmental
      - Emphasize the value of what was shared in conversation
      - Don't make parent feel they're missing out
      - Focus on what IS possible rather than what isn't
      </system_context>

  # Professional report generated FIRST (technical/clinical)
  professional_report_ready:
    when:
      OR:
        - baseline_video_analysis.exists: true
        - knowledge_is_rich: true
          user_actions.declined_video_recording: true
    artifact: "baseline_professional_report"
    message: |
      ×× ×™ ××›×™× ×” ×¢×‘×•×¨×š ×“×•×— ××§×¦×•×¢×™ - ×–×” ×™×™×§×— ×¨×’×¢ ××—×“. ğŸ“„

  # Parent report DERIVED from professional report (accessible Hebrew)
  report_ready:
    when:
      baseline_professional_report.exists: true
    artifact: "baseline_parent_report"
    message: |
      ×”×“×•×— ××•×›×Ÿ! ğŸ“„

      ×–×” ×”×™×” ×ª×”×œ×™×š ×¢×©×™×¨ - ×ª×•×“×” ×©×”×©×§×¢×ª ××ª ×”×–××Ÿ ×œ×©×ª×£.
      ××¢×›×©×™×• ×× ×™ ×›××Ÿ ×‘×©×‘×™×œ×š ×œ×›×œ ×©××œ×”, ×›×œ ×ª×¦×¤×™×ª, ×›×œ ×“×‘×¨ ×©××ª×¢×•×¨×¨ ×‘×“×¨×š. ğŸ’™
    ui:
      type: "card"
      default: "×œ×—×¦×™ ×¢×œ ×”×›×¨×˜×™×¡ '××“×¨×™×š ×œ×”×•×¨×™×' ×‘'×¤×¢×™×œ ×¢×›×©×™×•' ×œ××˜×” ×›×“×™ ×œ×§×¨×•× ××ª ×”×“×•×— ×”××œ×"

    # ğŸŒŸ Card displays when moment triggers
    card:
      card_id: "report_ready_card"
      card_type: success
      priority: 100

      # ğŸŒŸ Phase 1: Lifecycle configuration (Living Dashboard)
      lifecycle:
        trigger: transition  # Only create on FALSEâ†’TRUE, not every evaluation
        dismiss_when:
          artifacts.baseline_parent_report.viewed: true
        dismiss_on_action: view_report
        prevent_re_trigger: true  # Don't show again after dismissed

      content:
        title: "×”×“×•×— ×©×œ×š ××•×›×Ÿ! ğŸ“„âœ¨"
        body: |
          **×”×¢×¨×›×” ×”×•×©×œ××”!**

          ×”×›× ×ª×™ ×¢×‘×•×¨×š ×“×•×— ××§×™×£ ×¢×œ {child_name}:
          â€¢ ×—×•×–×§×•×ª ×•×ª×›×•× ×•×ª ×™×™×—×•×“×™×•×ª
          â€¢ ×ª×¦×¤×™×•×ª ×”×ª×¤×ª×—×•×ª×™×•×ª
          â€¢ ×”××œ×¦×•×ª ××¢×©×™×•×ª
          â€¢ ×¦×¢×“×™× ×”×‘××™×

          ×”×“×•×— ×›×ª×•×‘ ×‘×©×¤×” × ×’×™×©×”, ×¢× ×“×’×© ×¢×œ ×”×—×•×–×§×•×ª ×©×œ {child_name} ×•×”××¤×©×¨×•×™×•×ª ×œ×ª××™×›×”.
        footer: "×œ×—×¦×™ ×¢×œ '×”×¦×’ ×“×•×—' ×›×©××ª ××•×›× ×” ×œ×§×¨×•× ğŸ’™"

      actions:
        - view_report
        - download_report
        - consultation
      dismissible: true
      celebration_animation: true
    context: |
      <system_context type="parent_report_ready">
      The parent-friendly report is ready! This is derived from the professional report.

      CRITICAL - Report hierarchy:
      - baseline_professional_report: Technical/clinical report (generated first)
      - baseline_parent_report: Parent-friendly version (derived from professional)
      - Parent report is translated/adapted from professional report for accessibility

      What the parent report contains:
      - Synthesizes: conversation insights + (video analysis if available)
      - Written for PARENTS in accessible Hebrew (not clinical jargon)
      - Organized by developmental domains
      - Includes specific observations, patterns, and recommendations
      - The report exists as a DOCUMENT in the system (not something you recite)

      How to help parent USE the report:
      âœ… "×”×“×•×— ××•×›×Ÿ! ××ª ×™×›×•×œ×” ×œ×§×¨×•× ××•×ª×• ×‘×›×¨×˜×™×¡ '××“×¨×™×š ×œ×”×•×¨×™×'"
      âœ… Direct them to the UI card to READ the full report
      âœ… Offer to answer questions ABOUT the report after they read it
      âœ… "×× ××©×”×• ×œ× ×‘×¨×•×¨ ×‘×“×•×—, ×× ×™ ×›××Ÿ ×œ×¢× ×•×ª ×¢×œ ×©××œ×•×ª"
      âœ… Offer to explain specific sections if asked

      What you can now do:
      âœ… Discuss findings from the report (if parent asks)
      âœ… Clarify recommendations
      âœ… Answer: "What should I do next?"
      âœ… Suggest expert matching if appropriate
      âœ… Continue ongoing support and consultation

      What NOT to do:
      âŒ Don't RECITE the entire report in chat (it's a document to read)
      âŒ Don't say "I'll send you the report" (it's already in their UI)
      âŒ Don't summarize unprompted (let parent read first, then discuss)
      âŒ Don't claim you can modify the report (it's generated, not editable in chat)

      New capabilities unlocked:
      - view_reports: Parent can read the full report
      - find_experts: Can help find appropriate professionals
      - start_re_assessment: Can begin follow-up assessment later

      This marks transition to ONGOING SUPPORT phase:
      - Journey continues (no "end")
      - Always available for questions, observations, guidance
      - Can do re-assessment in future
      - Relationship with parent continues
      </system_context>

  # Ongoing support
  journal_entries:
    artifact: "journal_entries"
    # No prerequisites - always available via always_available list

  # Re-assessment flow
  re_assessment_guidelines_ready:
    when:
      baseline_parent_report.exists: true
      re_assessment.active: true
      knowledge_is_rich: true
    artifact: "re_assessment_video_guidelines"
    message: |
      ××¢×•×œ×”! ×× ×™ ××›×™× ×” ×œ×š ×”× ×—×™×•×ª ×¦×™×œ×•× ××¢×•×“×›× ×•×ª - ×–×” ×™×™×§×— ×¨×’×¢ ××—×“. ×”×”× ×—×™×•×ª ×™×•×¤×™×¢×• ×‘×›×¨×˜×™×¡ ×œ××˜×” ×‘×¨×’×¢ ×©×”×Ÿ ××•×›× ×•×ª. ğŸ“¹
    ui:
      type: "card"
      default: "×”×”× ×—×™×•×ª ×”××¢×•×“×›× ×•×ª ×™×•×¤×™×¢×• ×‘×›×¨×˜×™×¡ '×”× ×—×™×•×ª ×¦×™×œ×•× ××¢×•×“×›× ×•×ª' ×‘'×¤×¢×™×œ ×¢×›×©×™×•' ×‘×¢×•×“ ×¨×’×¢×™× ×¡×¤×•×¨×™×"
    context: |
      <system_context type="video_guidelines_process">
      You (Chitta) have just generated updated video filming guidelines for re-assessment.

      CRITICAL - How the video process works:
      1. The guidelines you created are displayed to the PARENT in a card in the UI
      2. The parent will read these guidelines, film videos of their child, and UPLOAD them through the system
      3. You CANNOT view videos directly - you are an AI assistant without video viewing capabilities
      4. When the parent uploads videos, the SYSTEM will process them and provide you with structured analysis data
      5. You will receive this analysis data as text/JSON that you CAN work with

      What you should tell the parent:
      - Acknowledge the updated guidelines are ready and visible in their UI
      - Encourage them to film when convenient based on the new guidelines
      - Explain they will upload the videos through the upload section
      - Reassure them you'll analyze the videos once uploaded (via the system's video processing)

      What you should NEVER say:
      âŒ "I can view your videos" or "send me the videos"
      âŒ "I'll watch the videos" or "I can see the videos"
      âŒ Any claim about direct video viewing capability

      The parent interacts with you through TEXT conversation. Videos go through a separate upload flow.
      </system_context>

  re_assessment_videos_ready:
    when:
      re_assessment_video_guidelines.exists: true
      uploaded_video_count: ">= 3"
    artifact: "re_assessment_videos"
    message: "×”×¡×¨×˜×•× ×™× ×œ×”×¢×¨×›×” ××—×•×“×©×ª ×”×•×¢×œ×•!"

  re_assessment_analysis_done:
    when:
      re_assessment_videos.exists: true
      videos_analyzed: true
    artifact: "re_assessment_video_analysis"
    message: "×”× ×™×ª×•×— ×”××¢×•×“×›×Ÿ ×”×•×©×œ×!"

  # Re-assessment professional report FIRST (technical/clinical)
  re_assessment_professional_report_ready:
    when:
      baseline_parent_report.exists: true
      re_assessment_video_analysis.exists: true
      OR:
        re_assessment_conversation_is_rich: true
    artifact: "updated_professional_report"
    message: |
      ×× ×™ ××›×™× ×” ×¢×‘×•×¨×š ×“×•×— ××§×¦×•×¢×™ ××¢×•×“×›×Ÿ - ×–×” ×™×™×§×— ×¨×’×¢. ğŸ“„

  # Re-assessment parent report DERIVED from professional (accessible Hebrew)
  re_assessment_report_ready:
    when:
      updated_professional_report.exists: true
    artifact: "updated_parent_report"
    message: |
      ×”×“×•×— ×”××¢×•×“×›×Ÿ ××•×›×Ÿ! ğŸ“Š

      ×›×“××™ ×œ×”×©×•×•×ª ××ª ×”×©×™× ×•×™×™× ×××– ×”×“×•×— ×”×§×•×“× - ×–×” ××¨××” ××ª ×”×”×ª×§×“××•×ª.
    ui:
      type: "card"
      default: "×œ×—×¦×™ ×¢×œ ×”×›×¨×˜×™×¡ '×“×•×— ××¢×•×“×›×Ÿ' ×‘'×¤×¢×™×œ ×¢×›×©×™×•' ×œ××˜×”"

  # ============================================
  # PERSISTENT STATE CARDS
  # ============================================
  # Cards that display while their conditions are true (not just on events)
  # These are "state moments" - they don't trigger artifacts, just show UI
  # ğŸŒŸ Wu Wei: Merged from context_cards.yaml

  # --- Initial Assessment State Cards ---

  conversation_depth_card:
    when:
      artifacts.baseline_parent_report.exists: false
      message_count: "> 0"
      artifacts.baseline_video_guidelines.exists: false
    card:
      card_type: guidance
      priority: 90
      title: "{knowledge_depth_indicator_emoji} {knowledge_depth_indicator_text}"
      body: "×ª×•×“×” ×¢×œ ×”×©×™×ª×•×£ ğŸ’™"
      footer: "××¤×©×¨ ×œ×©×ª×£ ×¢×•×“ ××• ×œ×©××•×œ ×›×œ ×©××œ×”"
      dismissible: true
      updates_dynamically: true
      persistent: true

  child_profile_card:
    when:
      artifacts.baseline_parent_report.exists: false
      child_name: "!= None"
      age: "> 0"
      artifacts.baseline_video_guidelines.exists: false
    card:
      card_type: guidance
      priority: 85
      title: "×¤×¨×•×¤×™×œ: {child_name}"
      body: "×’×™×œ {age}"
      dismissible: false
      updates_dynamically: true
      persistent: true

  guidelines_offer_card:
    when:
      artifacts.baseline_parent_report.exists: false
      artifacts.baseline_video_guidelines.prerequisites_met: true
      artifacts.baseline_video_guidelines.exists: false
      user_actions.declined_guidelines_offer: false
    card:
      card_type: suggestion
      priority: 95
      title: "××•×›× /×” ×œ×”× ×—×™×•×ª ×¦×™×œ×•×? ğŸ¬"
      body: |
        ×™×© ×œ×™ ××¡×¤×™×§ ××™×“×¢ ×›×“×™ ×œ×”×›×™×Ÿ ×œ×š ×”× ×—×™×•×ª ×¦×™×œ×•×
        ××•×ª×××•×ª ×‘××™×•×—×“ ×œ{child_name}.

        ×”×”× ×—×™×•×ª ×™×¢×–×¨×• ×œ×š ×œ×“×¢×ª ××” ×œ×¦×œ× ×•××™×š.
      footer: "×¨×•×¦×” ×©××›×™×Ÿ?"
      actions:
        - generate_guidelines
        - dismiss_card
      dismissible: true
      persistent: true

  guidelines_preparing_card:
    when:
      artifacts.baseline_parent_report.exists: false
      artifacts.baseline_video_guidelines.status: "generating"
    card:
      card_type: loading
      priority: 100
      title: "××›×™× ×” ×¢×‘×•×¨×š... â³"
      body: |
        âœ¨ ×”× ×—×™×•×ª ×¦×™×œ×•× ××•×ª×××•×ª ×œ{child_name}

        ×¨×’×¢ ×§×˜×Ÿ...
      dismissible: false
      persistent: true

  video_guidelines_card:
    when:
      filming_preference: "wants_videos"
      artifacts.baseline_parent_report.exists: false
      artifacts.baseline_video_guidelines.exists: true
      artifacts.baseline_video_guidelines.status: "ready"
    card:
      card_type: action_needed
      priority: 90
      title: "×”× ×—×™×•×ª ×”×¦×™×œ×•× ××•×›× ×•×ª! ğŸ“¹"
      body: |
        ×”×›× ×ª×™ ×¢×‘×•×¨×š ×”× ×—×™×•×ª ××•×ª×××•×ª ××™×©×™×ª ×¢×œ ×¡××š ××” ×©×¡×™×¤×¨×ª ×œ×™.

        **××” ×œ×¦×œ×:**
        {guidelines_summary}

        **×›××” ×¡×¨×˜×•× ×™×?**
        ×¦×¨×™×›×™× 3 ×¡×¨×˜×•× ×™× ×§×¦×¨×™× (2-5 ×“×§×•×ª ×›×œ ××—×“) ×‘××¦×‘×™× ×©×•× ×™×.

        {upload_progress}
      actions:
        - view_video_guidelines
        - consultation
      dismissible: false
      updates_dynamically: true
      persistent: true

  generate_report_card:
    when:
      filming_preference: "report_only"
      artifacts.baseline_parent_report.exists: false
    card:
      card_type: action_needed
      priority: 95
      title: "××•×›× ×” ×œ×”×›×™×Ÿ ×“×•×—! ğŸ“‹"
      body: |
        ×¢×œ ×¡××š ×›×œ ××” ×©×¡×™×¤×¨×ª ×œ×™ ×¢×œ {child_name}, ×× ×™ ×™×›×•×œ×” ×œ×”×›×™×Ÿ ×¢×‘×•×¨×š ×“×•×— ××¡×›× ××§×™×£.

        **××” ×™×”×™×” ×‘×“×•×—?**
        â€¢ ×¡×™×›×•× ×”×ª×¤×ª×—×•×ª×™ ×©×œ {child_name}
        â€¢ ×ª×•×‘× ×•×ª ×•×”××œ×¦×•×ª ××•×ª×××•×ª
        â€¢ ×¦×¢×“×™× ××•×¦×¢×™× ×•××©××‘×™×

        ×”×“×•×— ×™×”×™×” ××•×›×Ÿ ×ª×•×š ×›××” ×“×§×•×ª.
      actions:
        - generate_report
        - consultation
      dismissible: false
      persistent: true

  video_analysis_pending_card:
    when:
      artifacts.baseline_parent_report.exists: false
      uploaded_video_count: ">= 1"
      video_analysis_status: "pending"
    card:
      card_type: progress
      priority: 88
      title: "××•×›× ×™× ×œ× ×™×ª×•×—! ğŸ¥"
      body: |
        **×œ×—×¦×™ ×›××Ÿ ×›×“×™ ×œ×”×ª×—×™×œ ××ª ×”× ×™×ª×•×—**

        {uploaded_video_count} ×¡×¨×˜×•× ×™× ×”×•×¢×œ×• ×‘×”×¦×œ×—×”. ×× ×™ ××•×›× ×” ×œ×¦×¤×•×ª ×‘×”× ×‘×¢×™×•×Ÿ ×•×œ×—×¤×© ×“×¤×•×¡×™×, ×—×•×–×§×•×ª, ×•××ª×’×¨×™× ×‘×”×ª×¤×ª×—×•×ª ×©×œ {child_name}.

        ×”× ×™×ª×•×— ×œ×•×§×— ×‘×“×¨×š ×›×œ×œ 10-15 ×“×§×•×ª ğŸ’™
      actions:
        - analyze_videos
        - consultation
      dismissible: false
      persistent: true

  video_analysis_running_card:
    when:
      artifacts.baseline_parent_report.exists: false
      video_analysis_status: "analyzing"
    card:
      card_type: progress
      priority: 88
      title: "×× ×ª×—×ª ××ª ×”×¡×¨×˜×•× ×™×... ğŸ”"
      body: |
        **×”×ª×”×œ×™×š ×‘×¢×™×¦×•××•!**

        ×× ×™ ×¦×•×¤×” ×‘×¡×¨×˜×•× ×™× ×©×œ {child_name} ×•××—×¤×©×ª:
        â€¢ ×“×¨×›×™ ×ª×§×©×•×¨×ª
        â€¢ ××™× ×˜×¨××§×¦×™×•×ª ×—×‘×¨×ª×™×•×ª
        â€¢ ××©×—×§ ×•×™×¦×™×¨×ª×™×•×ª
        â€¢ ×ª×’×•×‘×•×ª ×—×•×©×™×•×ª
        â€¢ ×•×™×¡×•×ª ×¨×’×©×™
      actions:
        - consultation
        - add_journal_entry
      dismissible: false
      persistent: true

  # --- Ongoing Support State Cards ---

  ongoing_welcome_card:
    when:
      artifacts.baseline_parent_report.exists: true
      re_assessment.active: false
      phase_entry_message_shown: false
    card:
      card_type: ongoing_support
      priority: 85
      title: "×‘×¨×•×›×” ×”×‘××” ×œ×©×œ×‘ ×”×œ×™×•×•×™! ğŸ’™"
      body: |
        **×”×¢×¨×›×” ×”×¨××©×•× ×™×ª ×”×•×©×œ××” - ××” ×¢×›×©×™×•?**

        ××¢×›×©×™×• ×× ×™ ×›××Ÿ ×‘×©×‘×™×œ×š ×œ××•×¨×š ×–××Ÿ:

        ğŸ“– **×™×•××Ÿ ×”×ª×¤×ª×—×•×ª** - ×ª×™×¢×“×™ ×ª×¦×¤×™×•×ª ×•×× ×™ ××¢×–×•×¨ ×œ×š ×œ×¢×§×•×‘ ××—×¨×™ ×”×”×ª×§×“××•×ª

        ğŸ’¬ **×©××œ×•×ª ×•×ª××™×›×”** - ×‘×›×œ ×–××Ÿ ×©×™×© ×œ×š ×©××œ×”, ×× ×™ ×›××Ÿ

        ğŸ” **×—×™×‘×•×¨ ×œ××•××—×™×** - ××¢×–×•×¨ ×œ×š ×œ××¦×•× ××ª ×”×× ×©×™× ×”××ª××™××™×

        ğŸ”„ **×”×¢×¨×›×” ××—×•×“×©×ª** - ×›×©× ×¨×¦×”, × ×•×›×œ ×œ×¢×©×•×ª ×”×¢×¨×›×” ××¢×•×“×›× ×ª
      footer: "××™×Ÿ ××˜×¨×” ×§×‘×•×¢×” - ×–×” ×ª×”×œ×™×š. ×× ×™ ×›××Ÿ ××™×ª×š ğŸŒŸ"
      actions:
        - add_journal_entry
        - view_report
        - find_experts
        - consultation
      dismissible: true
      show_once: true
      persistent: true

  journal_card:
    when:
      artifacts.baseline_parent_report.exists: true
      journal_entry_count: "< 100"
    card:
      card_type: guidance
      priority: 70
      title: "×™×•××Ÿ ×”×ª×¤×ª×—×•×ª ğŸ“–"
      body: |
        **×œ××” ×™×•××Ÿ?**

        ×ª×™×¢×•×“ ×¨×’×¢×™×, ×ª×¦×¤×™×•×ª, ×•×©××œ×•×ª ×¢×•×–×¨:
        â€¢ ×œ×¢×§×•×‘ ××—×¨×™ ×”×ª×¤×ª×—×•×ª ×œ××•×¨×š ×–××Ÿ
        â€¢ ×œ×–×”×•×ª ×“×¤×•×¡×™×
        â€¢ ×œ×”×›×™×Ÿ ×©××œ×•×ª ×œ××•××—×™×
        â€¢ ×œ×¨××•×ª ××ª ×”×¦××™×—×”

        ××¤×©×¨ ×œ×›×ª×•×‘ ×›×œ ×“×‘×¨ - ××™×Ÿ "× ×›×•×Ÿ" ××• "×œ× × ×›×•×Ÿ" ğŸ’™
      actions:
        - add_journal_entry
        - view_journal
      dismissible: true
      re_show_after_days: 7
      persistent: true

  expert_finder_card:
    when:
      artifacts.baseline_parent_report.exists: true
      re_assessment.active: false
      expert_search_count: "< 3"
    card:
      card_type: guidance
      priority: 65
      title: "×¦×¨×™×›×” ×¢×–×¨×” ××§×¦×•×¢×™×ª? ğŸ‘¥"
      body: |
        **××¤×©×¨ ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××•××—×™×**

        ×‘×”×ª×‘×¡×¡ ×¢×œ ×”×“×•×— ×©×œ {child_name}, ××•×›×œ ×œ×”××œ×™×¥ ×¢×œ:
        â€¢ ××˜×¤×œ×™× ×‘×¢×™×¡×•×§
        â€¢ ×§×œ×™× ××™ ×ª×§×©×•×¨×ª
        â€¢ ×¤×¡×™×›×•×œ×•×’×™× ×”×ª×¤×ª×—×•×ª×™×™×
        â€¢ ×™×•×¢×¦×™× ×—×™× ×•×›×™×™×
      footer: "×œ×•×—×¦×™× ×¢×œ '××¦× ××•××—×™×' ×œ×”×ª×—×™×œ"
      actions:
        - find_experts
        - consultation
      dismissible: true
      re_show_after_days: 30
      persistent: true

  # --- Re-Assessment State Cards ---

  re_assessment_welcome_card:
    when:
      re_assessment.active: true
      phase_entry_message_shown: false
    card:
      card_type: progress
      priority: 90
      title: "×‘×•××™ × ×¢×“×›×Ÿ ××ª ×”×”×‘× ×” ×©×œ× ×• ğŸ”„"
      body: |
        **×”×¢×¨×›×” ××—×•×“×©×ª ×©×œ {child_name}**

        ×–×” ×”×–××Ÿ ×œ×¨××•×ª ××™×š {child_name} ×”×ª×¤×ª×—/×” ×××– ×”×”×¢×¨×›×” ×”×¨××©×•× ×™×ª.

        **×”×ª×”×œ×™×š:**
        1. ×©×™×—×” ×××•×§×“×ª ×¢×œ ×”×©×™× ×•×™×™× ×•×”×ª×¤×ª×—×•×ª
        2. ×¡×¨×˜×•× ×™× ×—×“×©×™× (×× × ×—×•×¥)
        3. ×“×•×— ××¢×•×“×›×Ÿ ×¢× ×”×©×•×•××” ×œ×‘×¡×™×¡
      footer: "×‘×•××™ × ×ª×—×™×œ - ××” ×”×©×ª× ×” ×××– ×”×¤×¢× ×”×§×•×“××ª?"
      actions:
        - continue_interview
        - view_journal
        - consultation
      dismissible: false
      show_once: true
      persistent: true

  re_assessment_progress_card:
    when:
      re_assessment.active: true
      artifacts.re_assessment_video_guidelines.exists: false
      message_count: "> 0"
    card:
      card_type: progress
      priority: 85
      title: "{knowledge_depth_indicator_emoji} {knowledge_depth_indicator_text}"
      body: "×××©×™×›×™× ×œ×”×¢××™×§ ××ª ×”×”×‘× ×” ×©×œ {child_name}"
      footer: "×ª×•×“×” ×¢×œ ×”×©×™×ª×•×£ ğŸ’™"
      actions:
        - continue_interview
        - upload_video
        - view_journal
        - consultation
      dismissible: false
      updates_dynamically: true
      persistent: true

  updated_report_ready_card:
    when:
      re_assessment.active: true
      artifacts.updated_parent_report.exists: true
      user_viewed_updated_report: false
    card:
      card_type: success
      priority: 95
      title: "×”×“×•×— ×”××¢×•×“×›×Ÿ ××•×›×Ÿ! ğŸ“Šâœ¨"
      body: |
        **×”×”×¢×¨×›×” ×”××—×•×“×©×ª ×”×•×©×œ××”!**

        ×”×“×•×— ×”×—×“×© ×›×•×œ×œ:
        â€¢ ×ª××•× ×” ××¢×•×“×›× ×ª ×©×œ {child_name}
        â€¢ ×”×©×•×•××” ×œ×”×¢×¨×›×” ×”×§×•×“××ª
        â€¢ ×”×ª×§×“××•×ª ×•×©×™× ×•×™×™×
        â€¢ ×”××œ×¦×•×ª ××¢×•×“×›× ×•×ª
      footer: "×—×•×–×¨×™× ×œ×œ×™×•×•×™ ×”×©×•×˜×£ ××¢×›×©×™×• ğŸ’™"
      actions:
        - view_report
        - download_report
        - compare_reports
        - consultation
      dismissible: false
      celebration_animation: true
      persistent: true

# ============================================
# PHILOSOPHY
# ============================================
philosophy: |
  Wu Wei - Effortless action through continuous flow (×¤×©×•×˜ - × ×˜×•×œ ×—×œ×§×™× ×¢×•×“×¤×™×)

  No phases. No gates. No redundancy. Just:
  1. Continuous conversation (always available)
  2. Knowledge accumulates naturally
  3. Prerequisites met â†’ Moments happen â†’ Capabilities unlock
  4. Parent can explore/ask anything anytime

  Simplification principles applied:
  - Merged artifacts + lifecycle_events + capabilities â†’ moments
  - Flattened structure (no nested objects except when/ui)
  - Removed duplicate information (descriptions, implementation docs)
  - Everything about a moment in ONE place
  - Only essential fields (when, artifact, message, ui, unlocks)

  Result: 50% less configuration, 100% of the functionality

metadata:
  version_history:
    - "1.0: Phase-based workflow (phases.yaml) - REMOVED"
    - "2.0: Wu Wei dependency graph (separate artifacts/events/capabilities)"
    - "3.0: Simplified Wu Wei (unified moments structure)"
    - "3.1: Removed phases.yaml - state derived from artifacts"
    - "3.2: Merged context_cards.yaml - single source of truth for cards"
  last_updated: "2025-11-25"
  breaking_changes:
    - "config['artifacts'] â†’ config['moments']"
    - "config['lifecycle_events'] â†’ config['moments']"
    - "config['capabilities'] â†’ config['always_available'] + moments[].unlocks"
    - "Moment structure flattened (when/artifact/message/ui/unlocks)"
    - "Cards now defined in moments (card_types, display_rules at top level)"
