# Context Cards - UI cards that reflect invisible state
# Cards guide users through the workflow by showing progress, next steps, and available actions
# ğŸŒŸ Wu Wei: Cards appear based on prerequisites, not phases

version: "2.0"
card_system_name: "child_development_context_cards"
description: "Dynamic UI cards that adapt based on artifacts and prerequisites (no phases)"

# Card display rules
display_rules:
  max_cards_visible: 4  # Don't overwhelm user
  priority_ordering: true  # Show highest priority cards first
  auto_dismiss: true  # Some cards auto-dismiss after action
  animation: fade_in_out

# Card types for styling
card_types:
  progress:
    icon: "progress-bar"
    color: "blue"
    style: "informational"

  action_needed:
    icon: "alert-circle"
    color: "orange"
    style: "call-to-action"

  success:
    icon: "check-circle"
    color: "green"
    style: "celebration"

  guidance:
    icon: "lightbulb"
    color: "purple"
    style: "helpful"

  ongoing_support:
    icon: "heart"
    color: "pink"
    style: "supportive"

# Cards in the system
cards:
  # ========================================
  # INITIAL ASSESSMENT CARDS (emergent state)
  # Shows when: baseline_parent_report.exists = false
  # ========================================

  welcome_card:
    name: "×‘×¨×•×›×” ×”×‘××”"
    name_en: "Welcome"
    card_type: guidance
    priority: 100  # Highest - show first

    # When to show this card
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      message_count: 0
      show_once: true

    # Card content
    content:
      title: "×©×œ×•× {parent_name}, × ×¢×™× ×œ×”×›×™×¨! ğŸ’™"
      body: |
        ×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×œ×š ×œ×”×‘×™×Ÿ ×˜×•×‘ ×™×•×ª×¨ ××ª ×”×”×ª×¤×ª×—×•×ª ×©×œ {child_name}.

        **××™×š ×–×” ×¢×•×‘×“?**
        1. × ×“×‘×¨ ×¢×œ {child_name} - ×”×©×™×—×” ×—×•×¤×©×™×ª ×•× ×¢×™××”
        2. ××ª ×ª×¢×œ×™ 3 ×¡×¨×˜×•× ×™× ×§×¦×¨×™×
        3. ×× ×ª×— ×•××›×™×Ÿ ×¢×‘×•×¨×š ×“×•×— ××§×™×£

        **×”×›×œ ×¤×¨×˜×™ ×•×××•×‘×˜×—.** ××¤×©×¨ ×œ×”×ª×—×™×œ ××ª×™ ×©× ×•×— ×œ×š.

      footer: "×‘×•××™ × ×ª×—×™×œ - ×¡×¤×¨×™ ×œ×™ ×§×¦×ª ×¢×œ {child_name} ğŸ˜Š"

    # Available actions from this card
    available_actions:
      - continue_interview
      - view_privacy_policy

    # Behavior
    dismissible: true
    auto_dismiss_after_action: true

  conversation_depth_card:
    name: "×¢×•××§ ×”×©×™×—×”"
    name_en: "Conversation Depth"
    card_type: guidance
    priority: 90

    # When to show - during active conversation
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      message_count: "> 0"
      artifacts.baseline_video_guidelines.exists: false  # Before guidelines ready

    # Card content (qualitative, not percentage!)
    content:
      # Uses knowledge_depth_indicator formatter (calculated dynamically)
      # Returns: {emoji, text} based on conversation richness
      # Examples:
      #   "ğŸ‘‹ ×”×ª×—×œ× ×• ×œ×”×›×™×¨"
      #   "ğŸ’­ ××›×™×¨×™× ××ª {child_name}..."
      #   "ğŸ’­ ×”×©×™×—×” ××ª×¢××§×ª"
      #   "ğŸ’™ ×”×›×¨× ×• ××ª {child_name}"
      title: "{knowledge_depth_indicator_emoji} {knowledge_depth_indicator_text}"
      body: "×ª×•×“×” ×¢×œ ×”×©×™×ª×•×£ ğŸ’™"

      footer: "××¤×©×¨ ×œ×©×ª×£ ×¢×•×“ ××• ×œ×©××•×œ ×›×œ ×©××œ×”"

    # Behavior
    dismissible: true
    updates_dynamically: true  # Re-render when knowledge changes

  child_profile_card:
    name: "×¤×¨×•×¤×™×œ ×”×™×œ×“/×”"
    name_en: "Child Profile"
    card_type: guidance  # Informational card, not progress
    priority: 85

    # When to show - as soon as we have basic info
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      child_name: "!= None"  # Has name
      age: "> 0"  # Has age

    # Card content
    content:
      title: "×¤×¨×•×¤×™×œ: {child_name}"
      body: "×’×™×œ {age}"

    # No actions - this is informational only, not clickable
    # available_actions: []

    # Behavior
    dismissible: false
    updates_dynamically: true

  # REMOVED: concerns_card and strengths_card
  # These informational cards were redundant during active conversation.
  # The parent already knows what they said - no need to show it back to them.
  # These might be useful later in ongoing phase as summaries, but for now they're removed.

  # If needed in future, these cards could show in ongoing phase:
  # display_conditions:
  #   baseline_parent_report.exists: true  # Only in ongoing, not during conversation
  #   re_assessment.active: false

  guidelines_offer_card:
    name: "×”×¦×¢×” ×œ×”×›× ×ª ×”× ×—×™×•×ª"
    name_en: "Guidelines Offer"
    card_type: suggestion
    priority: 95

    # When to show - prerequisites met but not generated yet
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      artifacts.baseline_video_guidelines.prerequisites_met: true
      artifacts.baseline_video_guidelines.exists: false
      user_actions.declined_guidelines_offer: false

    # Card content
    content:
      title: "××•×›× /×” ×œ×”× ×—×™×•×ª ×¦×™×œ×•×? ğŸ¬"
      body: |
        ×™×© ×œ×™ ××¡×¤×™×§ ××™×“×¢ ×›×“×™ ×œ×”×›×™×Ÿ ×œ×š ×”× ×—×™×•×ª ×¦×™×œ×•×
        ××•×ª×××•×ª ×‘××™×•×—×“ ×œ{child_name}.

        ×”×”× ×—×™×•×ª ×™×¢×–×¨×• ×œ×š ×œ×“×¢×ª ××” ×œ×¦×œ× ×•××™×š.

      footer: "×¨×•×¦×” ×©××›×™×Ÿ?"

    # Available actions
    available_actions:
      - name: "×›×Ÿ, ×ª×›×™× ×™"
        action: generate_guidelines
      - name: "×¢×•×“ ×¨×’×¢"
        action: dismiss_card
        sets: user_actions.declined_guidelines_offer = true

    # Behavior
    dismissible: true
    auto_dismiss_after_action: generate_guidelines

  guidelines_preparing_card:
    name: "××›×™× ×” ×”× ×—×™×•×ª"
    name_en: "Preparing Guidelines"
    card_type: loading
    priority: 100

    # When to show - while generating
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      artifacts.baseline_video_guidelines.status: "generating"

    # Card content
    content:
      title: "××›×™× ×” ×¢×‘×•×¨×š... â³"
      body: |
        âœ¨ ×”× ×—×™×•×ª ×¦×™×œ×•× ××•×ª×××•×ª ×œ{child_name}

        ×¨×’×¢ ×§×˜×Ÿ...

    # Behavior
    dismissible: false
    auto_replaces_with: guidelines_ready_card  # When status â†’ ready

  guidelines_ready_card:
    name: "×”× ×—×™×•×ª ××•×›× ×•×ª"
    name_en: "Guidelines Ready"
    card_type: success
    priority: 100

    # When to show - generated but not viewed yet
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      artifacts.baseline_video_guidelines.exists: true
      artifacts.baseline_video_guidelines.status: "ready"
      user_actions.viewed_guidelines: false

    # Card content
    content:
      title: "×”×”× ×—×™×•×ª ××•×›× ×•×ª! ğŸ¬"
      body: |
        ×”×›× ×ª×™ ×œ×š ×”× ×—×™×•×ª ×¦×™×œ×•× ××•×ª×××•×ª ×œ{child_name}.

        ×œ×—×¦×™ ×›×“×™ ×œ×§×¨×•× ××ª ×”×”× ×—×™×•×ª.

    # Available actions
    available_actions:
      - name: "×œ×—×¦×™ ×œ×¦×¤×™×™×”"
        action: view_guidelines
        tracks: user_actions.viewed_guidelines = true

    # Behavior
    dismissible: false
    auto_dismiss_after_action: view_guidelines

  upload_available_card:
    name: "××•×›× /×” ×œ×”×¢×œ×•×ª ×¡×¨×˜×•× ×™×"
    name_en: "Ready to Upload Videos"
    card_type: action_needed
    priority: 86

    # When to show - after viewing guidelines, before first upload
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      artifacts.baseline_video_guidelines.exists: true
      user_actions.viewed_guidelines: true
      uploaded_video_count: 0

    # Card content
    content:
      title: "××•×›× /×” ×œ×”×¢×œ×•×ª ×¡×¨×˜×•× ×™×? ğŸ“¹"
      body: |
        ×§×¨××ª ××ª ×”×”× ×—×™×•×ª - ××¤×©×¨ ×œ×”×ª×—×™×œ! âœ¨

        **××” ×× ×™ ××—×¤×©×ª:**
        {guidelines_brief_summary}

        **×›××” ×¡×¨×˜×•× ×™× ×¦×¨×™×š?**
        3 ×¡×¨×˜×•× ×™× ×§×¦×¨×™× (2-5 ×“×§×•×ª ×›×œ ××—×“) ×‘××¦×‘×™× ×©×•× ×™×.

        **××™×š ××¢×œ×™×?**
        ×œ×—×¦×™ ×¢×œ "×”×¢×œ×™ ×¡×¨×˜×•× ×™×" ×•×‘×—×¨×™ ××ª ×”×¡×¨×˜×•× ×™× ××”×’×œ×¨×™×” ××• ×¦×œ××™ ×—×“×©×™×.

      guidelines_brief_summary:
        source: video_guidelines_artifact
        extract: situations_to_capture
        format: "â€¢ {situation}"
        max_items: 3

      footer: "×‘×•××™ × ×ª×—×™×œ! ğŸ¬"

    # Available actions
    available_actions:
      - upload_video  # Primary action
      - view_video_guidelines  # Review if needed
      - consultation

    # Behavior
    dismissible: false
    auto_dismiss_after_action: upload_video

  video_guidelines_card:
    name: "×”× ×—×™×•×ª ×¦×™×œ×•×"
    name_en: "Video Guidelines"
    card_type: action_needed
    priority: 85

    # When to show
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      video_guidelines_status: ready
      uploaded_video_count: "< 3"

    # Card content
    content:
      title: "×”× ×—×™×•×ª ×”×¦×™×œ×•× ××•×›× ×•×ª! ğŸ“¹"
      body: |
        ×”×›× ×ª×™ ×¢×‘×•×¨×š ×”× ×—×™×•×ª ××•×ª×××•×ª ××™×©×™×ª ×¢×œ ×¡××š ××” ×©×¡×™×¤×¨×ª ×œ×™.

        **××” ×œ×¦×œ×:**
        {guidelines_summary}

        **×›××” ×¡×¨×˜×•× ×™×?**
        ×¦×¨×™×›×™× 3 ×¡×¨×˜×•× ×™× ×§×¦×¨×™× (2-5 ×“×§×•×ª ×›×œ ××—×“) ×‘××¦×‘×™× ×©×•× ×™×.

        {upload_progress}

      # Dynamic sections
      guidelines_summary:
        source: video_guidelines_artifact
        extract: situations_to_capture
        format: "â€¢ {situation}"
        max_items: 3

      upload_progress:
        template: "**×¢×“ ×›×” ×”×•×¢×œ×•: {uploaded_count}/3 ×¡×¨×˜×•× ×™×** {progress_emoji}"
        progress_emoji_by_count:
          0: "â¬œâ¬œâ¬œ"
          1: "âœ…â¬œâ¬œ"
          2: "âœ…âœ…â¬œ"
          3: "âœ…âœ…âœ…"

      footer_by_upload_count:
        0: "××¤×©×¨ ×œ×”×¢×œ×•×ª ××ª ×”×¡×¨×˜×•×Ÿ ×”×¨××©×•×Ÿ ğŸ¬"
        1: "×™×•×¤×™! ×‘×•××™ × ×¢×œ×” ×¢×•×“ 2 ×¡×¨×˜×•× ×™×"
        2: "×›××¢×˜ ×¡×™×™×× ×•! ×¢×•×“ ×¡×¨×˜×•×Ÿ ××—×“"

    # Available actions
    available_actions:
      - upload_video
      - view_video_guidelines  # See full guidelines
      - consultation

    # Behavior
    dismissible: false
    updates_dynamically: true
    auto_dismiss_when: "uploaded_video_count >= 3"

  video_analysis_card:
    name: "× ×™×ª×•×— ×¡×¨×˜×•× ×™×"
    name_en: "Video Analysis"
    card_type: progress
    priority: 88

    # When to show
    display_conditions:
      baseline_parent_report.exists: false  # Initial assessment state
      uploaded_video_count: ">= 3"
      video_analysis_status: ["pending", "analyzing"]
      reports_status: "!= ready"

    # Card content varies by analysis state
    content_by_status:
      pending:
        title: "××•×›× ×™× ×œ× ×™×ª×•×—! ğŸ¥"
        body: |
          3 ×”×¡×¨×˜×•× ×™× ×”×•×¢×œ×• ×‘×”×¦×œ×—×”.

          **××” ×§×•×¨×” ×¢×›×©×™×•?**
          ×× ×™ ×”×•×œ×›×ª ×œ× ×ª×— ××ª ×”×¡×¨×˜×•× ×™× - ×œ×¦×¤×•×ª ×‘×”× ×‘×¢×™×•×Ÿ ×•×œ×—×¤×© ×“×¤×•×¡×™×, ×—×•×–×§×•×ª, ×•××ª×’×¨×™×.

          ×–×” ×œ×•×§×— ×›××” ×–××Ÿ (×‘×“×¨×š ×›×œ×œ 10-15 ×“×§×•×ª), ××‘×œ ×©×•×•×” ××ª ×”×”××ª× ×” ğŸ’™

        actions: [analyze_videos, consultation]

      analyzing:
        title: "×× ×ª×—×ª ××ª ×”×¡×¨×˜×•× ×™×... ğŸ”"
        body: |
          **×”×ª×”×œ×™×š ×‘×¢×™×¦×•××•!**

          ×× ×™ ×¦×•×¤×” ×‘×¡×¨×˜×•× ×™× ×©×œ {child_name} ×•××—×¤×©×ª:
          â€¢ ×“×¨×›×™ ×ª×§×©×•×¨×ª
          â€¢ ××™× ×˜×¨××§×¦×™×•×ª ×—×‘×¨×ª×™×•×ª
          â€¢ ××©×—×§ ×•×™×¦×™×¨×ª×™×•×ª
          â€¢ ×ª×’×•×‘×•×ª ×—×•×©×™×•×ª
          â€¢ ×•×™×¡×•×ª ×¨×’×©×™

          {analysis_progress}

        analysis_progress:
          show_spinner: true
          estimated_time_remaining: "{minutes} ×“×§×•×ª"

        actions: [consultation, add_journal_entry]

    # Behavior
    dismissible: false
    updates_dynamically: true
    auto_dismiss_when: "video_analysis_status == complete"

  reports_ready_card:
    name: "×”×“×•×— ××•×›×Ÿ"
    name_en: "Report Ready"
    card_type: success
    priority: 100

    # When to show
    display_conditions:
      phase: [screening, ongoing]  # Can show in both
      reports_status: ready
      user_viewed_report: false

    # Card content
    content:
      title: "×”×“×•×— ×©×œ×š ××•×›×Ÿ! ğŸ“„âœ¨"
      body: |
        **×”×¢×¨×›×” ×”×•×©×œ××”!**

        ×”×›× ×ª×™ ×¢×‘×•×¨×š ×“×•×— ××§×™×£ ×¢×œ {child_name}:
        â€¢ ×—×•×–×§×•×ª ×•×ª×›×•× ×•×ª ×™×™×—×•×“×™×•×ª
        â€¢ ×ª×¦×¤×™×•×ª ×”×ª×¤×ª×—×•×ª×™×•×ª
        â€¢ ×”××œ×¦×•×ª ××¢×©×™×•×ª
        â€¢ ×¦×¢×“×™× ×”×‘××™×

        ×”×“×•×— ×›×ª×•×‘ ×‘×©×¤×” × ×’×™×©×”, ×¢× ×“×’×© ×¢×œ ×”×—×•×–×§×•×ª ×©×œ {child_name} ×•×”××¤×©×¨×•×™×•×ª ×œ×ª××™×›×”.

      footer: "×œ×—×¦×™ ×¢×œ '×”×¦×’ ×“×•×—' ×›×©××ª ××•×›× ×” ×œ×§×¨×•× ğŸ’™"

    # Available actions
    available_actions:
      - view_report
      - download_report
      - consultation

    # Behavior
    dismissible: true
    celebration_animation: true
    auto_dismiss_after_action: view_report

  # ========================================
  # ONGOING SUPPORT CARDS (emergent state)
  # Shows when: baseline_parent_report.exists = true AND re_assessment.active = false
  # ========================================

  ongoing_welcome_card:
    name: "×©×œ×‘ ×”×œ×™×•×•×™ ×”××ª××©×š"
    name_en: "Ongoing Support Phase"
    card_type: ongoing_support
    priority: 85

    # When to show
    display_conditions:
      baseline_parent_report.exists: true  # Ongoing support state
      re_assessment.active: false
      phase_entry_message_shown: false  # Show once when entering this state

    # Card content
    content:
      title: "×‘×¨×•×›×” ×”×‘××” ×œ×©×œ×‘ ×”×œ×™×•×•×™! ğŸ’™"
      body: |
        **×”×¢×¨×›×” ×”×¨××©×•× ×™×ª ×”×•×©×œ××” - ××” ×¢×›×©×™×•?**

        ××¢×›×©×™×• ×× ×™ ×›××Ÿ ×‘×©×‘×™×œ×š ×œ××•×¨×š ×–××Ÿ:

        ğŸ“– **×™×•××Ÿ ×”×ª×¤×ª×—×•×ª** - ×ª×™×¢×“×™ ×ª×¦×¤×™×•×ª ×•×× ×™ ××¢×–×•×¨ ×œ×š ×œ×¢×§×•×‘ ××—×¨×™ ×”×”×ª×§×“××•×ª

        ğŸ’¬ **×©××œ×•×ª ×•×ª××™×›×”** - ×‘×›×œ ×–××Ÿ ×©×™×© ×œ×š ×©××œ×”, ×× ×™ ×›××Ÿ

        ğŸ” **×—×™×‘×•×¨ ×œ××•××—×™×** - ××¢×–×•×¨ ×œ×š ×œ××¦×•× ××ª ×”×× ×©×™× ×”××ª××™××™×

        ğŸ”„ **×”×¢×¨×›×” ××—×•×“×©×ª** - ×›×©× ×¨×¦×”, × ×•×›×œ ×œ×¢×©×•×ª ×”×¢×¨×›×” ××¢×•×“×›× ×ª

      footer: "××™×Ÿ ××˜×¨×” ×§×‘×•×¢×” - ×–×” ×ª×”×œ×™×š. ×× ×™ ×›××Ÿ ××™×ª×š ğŸŒŸ"

    # Available actions
    available_actions:
      - add_journal_entry
      - view_report
      - find_experts
      - consultation

    # Behavior
    dismissible: true
    show_once: true

  journal_card:
    name: "×™×•××Ÿ ×”×ª×¤×ª×—×•×ª"
    name_en: "Development Journal"
    card_type: guidance
    priority: 70

    # When to show - only after interview is mostly complete or in ongoing phase
    display_conditions:
      phase: [ongoing, re_assessment]  # Only in ongoing/re-assessment, NOT during screening
      journal_entry_count: "< 100"  # Don't nag forever

    # Card content varies by journal state
    content_by_state:
      empty_journal:
        title: "×”×ª×—×™×œ×™ ×™×•××Ÿ ×”×ª×¤×ª×—×•×ª ğŸ“–"
        body: |
          **×œ××” ×™×•××Ÿ?**

          ×ª×™×¢×•×“ ×¨×’×¢×™×, ×ª×¦×¤×™×•×ª, ×•×©××œ×•×ª ×¢×•×–×¨:
          â€¢ ×œ×¢×§×•×‘ ××—×¨×™ ×”×ª×¤×ª×—×•×ª ×œ××•×¨×š ×–××Ÿ
          â€¢ ×œ×–×”×•×ª ×“×¤×•×¡×™×
          â€¢ ×œ×”×›×™×Ÿ ×©××œ×•×ª ×œ××•××—×™×
          â€¢ ×œ×¨××•×ª ××ª ×”×¦××™×—×”

          ××¤×©×¨ ×œ×›×ª×•×‘ ×›×œ ×“×‘×¨ - ××™×Ÿ "× ×›×•×Ÿ" ××• "×œ× × ×›×•×Ÿ" ğŸ’™

        actions: [add_journal_entry]

      has_entries:
        title: "×™×•××Ÿ ×”×”×ª×¤×ª×—×•×ª ×©×œ×š ğŸ“–"
        body: |
          **{journal_entry_count} ×¨×©×•××•×ª ×¢×“ ×›×”**

          {recent_entry_preview}

          ×ª×™×¢×•×“ ×¨×¦×™×£ ×¢×•×–×¨ ×œ×¨××•×ª ××ª ×”×ª××•× ×” ×”×’×“×•×œ×” ×•×œ×¢×§×•×‘ ××—×¨×™ ×©×™× ×•×™×™×.

        recent_entry_preview:
          source: latest_journal_entry
          format: |
            **××—×¨×•×Ÿ:**
            ğŸ“… {entry_date}
            "{entry_content_preview}..."

        actions: [add_journal_entry, view_journal]

    # Behavior
    dismissible: true
    re_show_after_days: 7  # Gentle reminder

  follow_up_summary_ready_card:
    name: "×¡×™×›×•× ××¢×§×‘ ××•×›×Ÿ"
    name_en: "Follow-up Summary Ready"
    card_type: success
    priority: 80

    # When to show
    display_conditions:
      baseline_parent_report.exists: true  # Ongoing support state
      re_assessment.active: false
      has_new_follow_up_summary: true
      user_viewed_summary: false

    # Card content
    content:
      title: "×¡×™×›×•× ×”×ª×§×•×¤×” ×”××—×¨×•× ×” ğŸ“Š"
      body: |
        × ×™×ª×—×ª×™ ××ª ×¨×©×•××•×ª ×”×™×•××Ÿ ×©×œ×š ×-{days_covered} ×”×™××™× ×”××—×¨×•× ×™×.

        **×‘×¡×™×›×•×:**
        â€¢ ×ª×¦×¤×™×•×ª ××¨×›×–×™×•×ª
        â€¢ ×“×¤×•×¡×™× ×©×–×™×”×™×ª×™
        â€¢ ×”×ª×§×“××•×ª ×‘×™×—×¡ ×œ×‘×¡×™×¡
        â€¢ ×”××œ×¦×•×ª ×œ×¦×¢×“×™× ×”×‘××™×

        {summary_preview}

      summary_preview:
        source: latest_follow_up_summary
        extract: key_observations.progress_areas
        format: "âœ¨ {progress_area}"
        max_items: 2

      footer: "×›×“××™ ×œ×”×¢×™×£ ××‘×˜ ğŸ’™"

    # Available actions
    available_actions:
      - view_follow_up_summary
      - download_summary
      - consultation

    # Behavior
    dismissible: true
    auto_dismiss_after_action: view_follow_up_summary

  expert_finder_card:
    name: "××¦×™××ª ××•××—×™×"
    name_en: "Find Experts"
    card_type: guidance
    priority: 65

    # When to show
    display_conditions:
      baseline_parent_report.exists: true  # Ongoing support state
      re_assessment.active: false
      reports_status: ready
      expert_search_count: "< 3"  # Don't show forever

    # Card content
    content:
      title: "×¦×¨×™×›×” ×¢×–×¨×” ××§×¦×•×¢×™×ª? ğŸ‘¥"
      body: |
        **××¤×©×¨ ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××•××—×™×**

        ×‘×”×ª×‘×¡×¡ ×¢×œ ×”×“×•×— ×©×œ {child_name}, ××•×›×œ ×œ×”××œ×™×¥ ×¢×œ:
        â€¢ ××˜×¤×œ×™× ×‘×¢×™×¡×•×§
        â€¢ ×§×œ×™× ××™ ×ª×§×©×•×¨×ª
        â€¢ ×¤×¡×™×›×•×œ×•×’×™× ×”×ª×¤×ª×—×•×ª×™×™×
        â€¢ ×™×•×¢×¦×™× ×—×™× ×•×›×™×™×
        â€¢ {additional_specialist}

        ×”×”××œ×¦×•×ª ××•×ª×××•×ª ×œ×¦×¨×›×™× ×•×œ××™×§×•× ×©×œ×š.

      additional_specialist:
        source: professional_report
        extract: recommendations.specialist_referrals
        format: "{specialist_type}"

      footer: "×œ×•×—×¦×™× ×¢×œ '××¦× ××•××—×™×' ×œ×”×ª×—×™×œ"

    # Available actions
    available_actions:
      - find_experts
      - consultation

    # Behavior
    dismissible: true
    re_show_after_days: 30

  # ========================================
  # RE-ASSESSMENT CARDS (emergent state)
  # Shows when: re_assessment.active = true
  # ========================================

  re_assessment_welcome_card:
    name: "×”×¢×¨×›×” ××—×•×“×©×ª"
    name_en: "Re-assessment"
    card_type: progress
    priority: 90

    # When to show
    display_conditions:
      re_assessment.active: true  # Re-assessment state
      phase_entry_message_shown: false

    # Card content
    content:
      title: "×‘×•××™ × ×¢×“×›×Ÿ ××ª ×”×”×‘× ×” ×©×œ× ×• ğŸ”„"
      body: |
        **×”×¢×¨×›×” ××—×•×“×©×ª ×©×œ {child_name}**

        ×–×” ×”×–××Ÿ ×œ×¨××•×ª ××™×š {child_name} ×”×ª×¤×ª×—/×” ×××– ×”×”×¢×¨×›×” ×”×¨××©×•× ×™×ª.

        **×”×ª×”×œ×™×š:**
        1. ×©×™×—×” ×××•×§×“×ª ×¢×œ ×”×©×™× ×•×™×™× ×•×”×ª×¤×ª×—×•×ª
        2. ×¡×¨×˜×•× ×™× ×—×“×©×™× (×× × ×—×•×¥)
        3. ×“×•×— ××¢×•×“×›×Ÿ ×¢× ×”×©×•×•××” ×œ×‘×¡×™×¡

        {focus_areas}

      focus_areas:
        source: re_assessment_configuration
        extract: areas_to_re_evaluate
        format: "â€¢ {area}"

      footer: "×‘×•××™ × ×ª×—×™×œ - ××” ×”×©×ª× ×” ×××– ×”×¤×¢× ×”×§×•×“××ª?"

    # Available actions
    available_actions:
      - continue_interview
      - view_journal  # Review what was documented
      - consultation

    # Behavior
    dismissible: false
    show_once: true

  re_assessment_progress_card:
    name: "×”×ª×§×“××•×ª ×”×¢×¨×›×” ××—×•×“×©×ª"
    name_en: "Re-assessment Progress"
    card_type: progress
    priority: 85

    # When to show
    display_conditions:
      re_assessment.active: true  # Re-assessment state
      artifacts.re_assessment_video_guidelines.exists: false
      message_count: "> 0"

    # Card content
    content:
      title: "{knowledge_depth_indicator_emoji} {knowledge_depth_indicator_text}"
      body: |
        {comparison_to_baseline}

        **×××•×§×“×™× ×¢×œ:**
        {focus_areas}

      comparison_to_baseline:
        source: baseline_parent_report
        format: |
          **×‘×”×©×•×•××” ×œ×‘×¡×™×¡ ({baseline_date}):**
          {initial_concerns} â† ××” ×©×“××’ ××–
          {current_state} â† ××™×¤×” ×× ×—× ×• ×¢×›×©×™×•

      footer: "×ª×•×“×” ×¢×œ ×”×©×™×ª×•×£ ğŸ’™"

    # Available actions
    available_actions:
      - continue_interview
      - upload_video
      - view_journal
      - consultation

    # Behavior
    dismissible: false
    updates_dynamically: true

  updated_report_ready_card:
    name: "×“×•×— ××¢×•×“×›×Ÿ ××•×›×Ÿ"
    name_en: "Updated Report Ready"
    card_type: success
    priority: 95

    # When to show
    display_conditions:
      re_assessment.active: true  # Re-assessment state
      updated_reports_status: ready
      user_viewed_updated_report: false

    # Card content
    content:
      title: "×”×“×•×— ×”××¢×•×“×›×Ÿ ××•×›×Ÿ! ğŸ“Šâœ¨"
      body: |
        **×”×”×¢×¨×›×” ×”××—×•×“×©×ª ×”×•×©×œ××”!**

        ×”×“×•×— ×”×—×“×© ×›×•×œ×œ:
        â€¢ ×ª××•× ×” ××¢×•×“×›× ×ª ×©×œ {child_name}
        â€¢ ×”×©×•×•××” ×œ×”×¢×¨×›×” ×”×§×•×“××ª
        â€¢ ×”×ª×§×“××•×ª ×•×©×™× ×•×™×™×
        â€¢ ×”××œ×¦×•×ª ××¢×•×“×›× ×•×ª

        {progress_highlight}

      progress_highlight:
        source: updated_parent_report
        extract: comparison_to_baseline.progress_made
        format: "ğŸŒŸ {progress_item}"
        max_items: 2

      footer: "×—×•×–×¨×™× ×œ×œ×™×•×•×™ ×”×©×•×˜×£ ××¢×›×©×™×• ğŸ’™"

    # Available actions
    available_actions:
      - view_report
      - download_report
      - compare_reports  # Side-by-side
      - consultation

    # Behavior
    dismissible: false
    celebration_animation: true
    auto_dismiss_after_action: view_report
    on_dismiss:
      set_flags:
        - baseline_complete: true  # Baseline assessment is done
        - re_assessment.active: false  # Return to ongoing support

# Card generation logic
card_generation:
  evaluation_order:
    - "Check artifact prerequisites"
    - "Check artifact statuses"
    - "Check user state (viewed_report, journal_count, etc.)"
    - "Evaluate display_conditions"
    - "Sort by priority"
    - "Take top N cards based on max_cards_visible"

  dynamic_content:
    variable_resolution:
      source_priority:
        - extracted_data  # From interview
        - artifacts  # From generated reports
        - session_state  # Current phase, completeness
        - user_preferences  # Language, tone

      available_variables:
        - "{parent_name}"
        - "{child_name}"
        - "{age}"
        - "{knowledge_depth_indicator_emoji}"
        - "{knowledge_depth_indicator_text}"
        - "{uploaded_count}"
        - "{journal_entry_count}"
        - "{days_since_baseline}"
        - "{phase}"
        - And more from context

  template_engine:
    syntax: jinja2_compatible
    filters:
      - format_date
      - format_percentage
      - truncate
      - pluralize_he  # Hebrew pluralization
    functions:
      - calculate_time_since
      - extract_from_artifact
      - count_by_status

# Metadata
metadata:
  designed_for: "child_development_workflow"
  language: "he"
  last_updated: "2025-11-08"
  notes: |
    ğŸŒŸ Wu Wei: Context cards are the UI reflection of invisible state

    1. They GUIDE users through the workflow
       - Show what's next
       - Explain current state
       - Offer clear actions

    2. They ADAPT to artifacts and prerequisites (NOT phases)
       - Initial assessment: conversation-focused, guides toward guidelines
       - Ongoing support: journal-focused, questions and experts
       - Re-assessment: comparison-focused, tracks progress

    3. They CONNECT to system state
       - Artifacts (what exists?)
       - Prerequisites (what's ready?)
       - Actions (what can user do?)
       - Flags (re_assessment.active?)

    4. They COMMUNICATE with warmth
       - Hebrew, empathetic tone
       - Strength-based language
       - Clear next steps
       - No pressure

    Key Wu Wei principles:
    - Cards appear/disappear based on artifact prerequisites, NOT phases
    - Priority determines order when multiple shown
    - Dynamic content from session state
    - Actions directly connected to user intent
    - Continuous conversation always - no "complete interview" gate
    - Qualitative progress (×”×©×™×—×” ××ª×¢××§×ª) not quantitative (76%)
